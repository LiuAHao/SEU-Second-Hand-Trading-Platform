{% extends "base.html" %}

{% block title %}é¦–é¡µ - ä¸œå—å¤§å­¦æ ¡å›­äºŒæ‰‹äº¤æ˜“å¹³å°{% endblock %}

{% block content %}
<!-- æ¬¢è¿æ¨ªå¹… -->
<div class="page-header">
    <div class="container">
        <h1>ğŸ“ æ¬¢è¿æ¥åˆ° SEU æ ¡å›­äºŒæ‰‹äº¤æ˜“å¹³å°</h1>
        <p style="color: rgba(255, 255, 255, 0.95); margin-bottom: var(--spacing-lg); font-size: var(--font-size-lg);">
            ç»¿è‰²å¾ªç¯ Â· ä¾¿æ·äº¤æ˜“ Â· è®©é—²ç½®ç‰©å“ç„•å‘æ–°ç”Ÿ âœ¨
        </p>
        <div style="display: flex; gap: var(--spacing-md); justify-content: center; flex-wrap: wrap;">
            <a href="/publish-item" class="btn btn--primary btn--lg">ğŸ“¦ å‘å¸ƒå•†å“</a>
            <a href="/items" class="btn btn--secondary btn--lg">ğŸ›ï¸ æµè§ˆå•†å“</a>
        </div>
    </div>
</div>

<!-- ä¸»è¦å†…å®¹ -->
<div class="container">
    <!-- åˆ†ç±»å¯¼èˆª -->
    <section style="margin-bottom: var(--spacing-2xl);">
        <h2 style="margin-bottom: var(--spacing-lg); text-align: center; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            ğŸ“‚ æµè§ˆåˆ†ç±»
        </h2>
        <div class="grid grid--cols-4">
            <a href="/items?category=books" class="category-card" style="text-decoration: none; color: inherit;">
                <div style="font-size: 56px; margin-bottom: var(--spacing-md);">ğŸ“š</div>
                <h3 style="margin: 0; color: var(--color-text-primary);">æ•™æä¹¦ç±</h3>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--spacing-sm); margin-bottom: 0;">
                    é—²ç½®æ•™æ Â· å‚è€ƒä¹¦ç±
                </p>
            </a>
            <a href="/items?category=electronics" class="category-card" style="text-decoration: none; color: inherit;">
                <div style="font-size: 56px; margin-bottom: var(--spacing-md);">ğŸ’»</div>
                <h3 style="margin: 0; color: var(--color-text-primary);">ç”µå­äº§å“</h3>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--spacing-sm); margin-bottom: 0;">
                    æ‰‹æœºç”µè„‘ Â· æ•°ç é…ä»¶
                </p>
            </a>
            <a href="/items?category=daily" class="category-card" style="text-decoration: none; color: inherit;">
                <div style="font-size: 56px; margin-bottom: var(--spacing-md);">ğŸ›‹ï¸</div>
                <h3 style="margin: 0; color: var(--color-text-primary);">ç”Ÿæ´»ç”¨å“</h3>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--spacing-sm); margin-bottom: 0;">
                    å®¿èˆç”¨å“ Â· ç”Ÿæ´»æ‚ç‰©
                </p>
            </a>
            <a href="/items?category=sports" class="category-card" style="text-decoration: none; color: inherit;">
                <div style="font-size: 56px; margin-bottom: var(--spacing-md);">âš½</div>
                <h3 style="margin: 0; color: var(--color-text-primary);">è¿åŠ¨å™¨æ</h3>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--spacing-sm); margin-bottom: 0;">
                  è¿åŠ¨è£…å¤‡ Â· å¥èº«å™¨æ
                </p>
            </a>
        </div>
    </section>

    <!-- çƒ­é—¨å•†å“ -->
    <section style="margin-bottom: var(--spacing-2xl);">
        <div class="flex flex--between" style="margin-bottom: var(--spacing-lg); align-items: center;">
            <h2 style="margin: 0; display: flex; align-items: center; gap: var(--spacing-sm);">
                <span class="feature-tag">ğŸ”¥ çƒ­é—¨</span>
                <span>çƒ­é—¨å•†å“</span>
            </h2>
            <a href="/items?sort=popular" class="btn btn--text">æŸ¥çœ‹æ›´å¤š â†’</a>
        </div>
        <div class="grid grid--cols-4" id="featured-items">
            <!-- ç”± JavaScript åŠ¨æ€åŠ è½½ -->
            <div class="skeleton" style="height: 300px;"></div>
            <div class="skeleton" style="height: 300px;"></div>
            <div class="skeleton" style="height: 300px;"></div>
            <div class="skeleton" style="height: 300px;"></div>
        </div>
    </section>

    <!-- æœ€æ–°å•†å“ -->
    <section style="margin-bottom: var(--spacing-2xl);">
        <div class="flex flex--between" style="margin-bottom: var(--spacing-lg); align-items: center;">
            <h2 style="margin: 0; display: flex; align-items: center; gap: var(--spacing-sm);">
                <span class="feature-tag" style="background: var(--gradient-secondary);">âœ¨ æœ€æ–°</span>
                <span>æœ€æ–°ä¸Šæ¶</span>
            </h2>
            <a href="/items?sort=latest" class="btn btn--text">æŸ¥çœ‹æ›´å¤š â†’</a>
        </div>
        <div class="grid grid--cols-4" id="latest-items">
            <!-- ç”± JavaScript åŠ¨æ€åŠ è½½ -->
            <div class="skeleton" style="height: 300px;"></div>
            <div class="skeleton" style="height: 300px;"></div>
            <div class="skeleton" style="height: 300px;"></div>
            <div class="skeleton" style="height: 300px;"></div>
        </div>
    </section>

    <!-- å¹³å°ä¿¡æ¯ -->
    <section style="margin-bottom: var(--spacing-2xl);">
        <h2 style="text-align: center; margin-bottom: var(--spacing-lg); background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            ä¸ºä»€ä¹ˆé€‰æ‹© SEU äºŒæ‰‹æµè½¬ï¼ŸğŸ’¡
        </h2>
        <div class="grid grid--cols-3">
            <div class="card hover-lift" style="padding: var(--spacing-xl);">
                <div style="font-size: 48px; margin-bottom: var(--spacing-md);">ğŸ”</div>
                <h3 style="margin-bottom: var(--spacing-sm); color: var(--color-primary);">å®‰å…¨å¯ä¿¡</h3>
                <p style="margin: 0; color: var(--color-text-secondary); line-height: 1.6;">
                    é€šè¿‡æ ¡å›­èº«ä»½è®¤è¯ï¼Œç¡®ä¿äº¤æ˜“åŒæ–¹çš„çœŸå®æ€§ï¼Œè®©äº¤æ˜“æ›´æ”¾å¿ƒã€‚
                </p>
            </div>
            <div class="card hover-lift" style="padding: var(--spacing-xl);">
                <div style="font-size: 48px; margin-bottom: var(--spacing-md);">âš¡</div>
                <h3 style="margin-bottom: var(--spacing-sm); color: var(--color-primary);">å¿«é€Ÿä¾¿æ·</h3>
                <p style="margin: 0; color: var(--color-text-secondary); line-height: 1.6;">
                    æ™ºèƒ½æœç´¢å’Œåˆ†ç±»ï¼Œå¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„å•†å“ï¼Œæ ¡å›­å†…é…é€æ›´ä¾¿åˆ©ã€‚
                </p>
            </div>
            <div class="card hover-lift" style="padding: var(--spacing-xl);">
                <div style="font-size: 48px; margin-bottom: var(--spacing-md);">ğŸ’š</div>
                <h3 style="margin-bottom: var(--spacing-sm); color: var(--color-primary);">èµ„æºå¾ªç¯</h3>
                <p style="margin: 0; color: var(--color-text-secondary); line-height: 1.6;">
                    æ¨åŠ¨ç»¿è‰²æ¶ˆè´¹ï¼Œè®©é—²ç½®ç‰©å“å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œé€ ç¦æ›´å¤šæ ¡å›­ç”¨æˆ·ã€‚
                </p>
            </div>
        </div>
    </section>
</div>

{% endblock %}

{% block extra_js %}
<script>
/**
 * é¦–é¡µæ•°æ®åŠ è½½å’Œäº¤äº’
 */
document.addEventListener('DOMContentLoaded', async () => {
    const renderCardImage = (item) => {
        if (item.image) {
            return `<img src="${item.image}" alt="${item.title}" class="product-card__image">`;
        }
        return `<div class="product-card__image product-card__image--empty"><span>æš‚æ— å›¾ç‰‡</span></div>`;
    };
    // åŠ è½½çƒ­é—¨å•†å“
    try {
        const featuredResponse = await API.recommend.getPopular({ limit: 4 });
        const featuredContainer = document.getElementById('featured-items');
        const featuredData = ((featuredResponse.data && featuredResponse.data.items) || featuredResponse.data || [])
            .filter(item => (item.stock ?? 0) > 0 && item.is_active !== false);
        
        if (featuredData.length > 0) {
            featuredContainer.innerHTML = featuredData.map(item => `
                <a href="/items/${item.id}" class="product-card" style="text-decoration: none; color: inherit;">
                    ${renderCardImage(item)}
                    <div class="product-card__content">
                        <h3 class="product-card__title">${item.title}</h3>
                        <p class="product-card__description">${item.description.substring(0, 60)}...</p>
                        <div class="product-card__price">Â¥${Number(item.price || 0).toFixed(2)}</div>
                        <div class="product-card__seller text-sm text-muted">å–å®¶: ${item.seller_name}</div>
                        ${item.stock > 0 ? '' : '<span class="product-card__badge">ç¼ºè´§</span>'}
                    </div>
                </a>
            `).join('');
        } else {
            featuredContainer.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state__icon">ğŸ›’</div>
                    <div class="empty-state__title">æš‚æ— çƒ­é—¨å•†å“</div>
                    <p class="empty-state__description">ç¨åå†æ¥çœ‹çœ‹ï¼Œæˆ–å»å‘å¸ƒä¸€æ¡æ–°å•†å“å§</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('åŠ è½½çƒ­é—¨å•†å“å¤±è´¥:', error);
        document.getElementById('featured-items').innerHTML = `
            <div class="empty-state" style="grid-column: 1 / -1;">
                <div class="empty-state__icon">âš ï¸</div>
                <div class="empty-state__title">åŠ è½½å¤±è´¥</div>
                <p class="empty-state__description">æ— æ³•åŠ è½½çƒ­é—¨å•†å“ï¼Œè¯·ç¨åé‡è¯•</p>
            </div>
        `;
    }

    // åŠ è½½æœ€æ–°å•†å“
    try {
        const latestResponse = await API.recommend.getLatest({ limit: 4 });
        const latestContainer = document.getElementById('latest-items');
        const latestData = ((latestResponse.data && latestResponse.data.items) || latestResponse.data || [])
            .filter(item => (item.stock ?? 0) > 0 && item.is_active !== false);
        
        if (latestData.length > 0) {
            latestContainer.innerHTML = latestData.map(item => `
                <a href="/items/${item.id}" class="product-card" style="text-decoration: none; color: inherit;">
                    ${renderCardImage(item)}
                    <div class="product-card__content">
                        <h3 class="product-card__title">${item.title}</h3>
                        <p class="product-card__description">${item.description.substring(0, 60)}...</p>
                        <div class="product-card__price">Â¥${Number(item.price || 0).toFixed(2)}</div>
                        <div class="product-card__seller text-sm text-muted">å–å®¶: ${item.seller_name}</div>
                        ${item.stock > 0 ? '' : '<span class="product-card__badge">ç¼ºè´§</span>'}
                    </div>
                </a>
            `).join('');
        } else {
            latestContainer.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state__icon">ğŸ“¦</div>
                    <div class="empty-state__title">æš‚æ— æœ€æ–°ä¸Šæ¶</div>
                    <p class="empty-state__description">å½“å‰æ²¡æœ‰æ–°å•†å“ï¼Œæ¬¢è¿å‘å¸ƒæ‚¨çš„äºŒæ‰‹å¥½ç‰©</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('åŠ è½½æœ€æ–°å•†å“å¤±è´¥:', error);
        document.getElementById('latest-items').innerHTML = `
            <div class="empty-state" style="grid-column: 1 / -1;">
                <div class="empty-state__icon">âš ï¸</div>
                <div class="empty-state__title">åŠ è½½å¤±è´¥</div>
                <p class="empty-state__description">æ— æ³•åŠ è½½æœ€æ–°å•†å“ï¼Œè¯·ç¨åé‡è¯•</p>
            </div>
        `;
    }
});
</script>
{% endblock %}